<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.oceansoft.szga.smp.mapper.RoadMapper">
    <select id="test" resultType="java.util.HashMap" parameterType="java.util.List">
        select
        *
        from
        rpt_aqjg_ggjt_yhlxtj
        where
        tjrq=to_char(CURRENT_DATE, 'yyyy-mm-dd')
    </select>

    <select id="getAddress" resultType="java.util.HashMap">
        select distinct xqdm AS deptid, xqmc as deptname from rpt_aqjg_ggjt_qyxzfx order by xqdm
    </select>

    <select id="getSourceSum" resultType="java.util.HashMap" parameterType="com.oceansoft.szga.smp.entity.SourceNum">
        WITH dljtytgltj AS
        (
            select * from (
                select t.lx, t.year || '-' || t.mon as ny, sl
                FROM rpt_aqjg_ggjt_dljtytgltj t
                where t.tjrq = to_char(CURRENT_DATE -1, 'yyyy-MM-dd') and lx in ('1','2','3')
            ) dlj where 1=1
            <if test="type=='nf'">
                and ny BETWEEN #{nyold} || '-01' and #{nynew} || '-12'
            </if>
            <if test="type=='yf'">
                and ny BETWEEN #{nyold} and #{nynew}
            </if>

        )
        select
        (select sum(sl) from dljtytgltj where lx = '1') as qysum,
        (select sum(sl) from dljtytgltj where lx = '2') as clsum,
        (select sum(sl) from dljtytgltj where lx = '3') as rysum
    </select>

    <select id="getFirmAnalzeSum" resultType="java.util.HashMap" parameterType="com.oceansoft.szga.smp.entity.SourceNum">
        WITH qyxzfx AS
            (
                select * from (
                  select t.year || '-' || t.mon as ny, t.xzdl, t.xzdlmc, t.xzxl, coalesce(t.xzxlmc, t.xzdlmc) as xzxlmc, dwsl, xqdm, xqmc
                from rpt_aqjg_ggjt_qyxzfx t
                where t.tjrq = to_char(CURRENT_DATE -1, 'yyyy-MM-dd')
                and t.xzdl in ('1','2','3','4')
                ) dlj where 1=1
                <if test="type=='nf'">
                    and ny BETWEEN #{nyold} || '-01' and #{nynew} || '-12'
                </if>
                <if test="type=='yf'">
                    and ny BETWEEN #{nyold} and #{nynew}
                </if>
            )
            select xzdl,xzdlmc,'flhj' xzxlmc, sum(dwsl) dwsl from qyxzfx group by xzdl,xzdlmc
            union all
            select xzdl,xzdlmc,xzxlmc,coalesce(sum(dwsl),0) dwsl from qyxzfx where xzdl='1' group by xzdlmc,xzxlmc,xzdl
            union all
            select xzdl,xzdlmc,xzxlmc,coalesce(sum(dwsl),0) dwsl from qyxzfx where xzdl='2' group by xzdlmc,xzxlmc,xzdl
            union all
            select xzdl,xzdlmc,xzxlmc,coalesce(sum(dwsl),0) dwsl from qyxzfx where xzdl='3' group by xzdlmc,xzxlmc,xzdl
            union all
            select xzdl,xzdlmc,xzxlmc,coalesce(sum(dwsl),0) dwsl from qyxzfx where xzdl='4' group by xzdlmc,xzxlmc,xzdl
    </select>
</mapper>