<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.oceansoft.szga.smp.mapper.DataModelMapper">
    <cache type="org.apache.ibatis.cache.impl.PerpetualCache"
           size="1024"
           eviction="LRU"
           readOnly="true"/>
    <select id="selectPageJjaj" resultType="java.util.HashMap">

        select jszh,
            dabh,
            zjcx,
            dsr,
            hphm,
            wfsj  from(
        select distinct *
        from ods.ods_rt_trff_app_vio_force a
        where substr(a.fxjg,1,4)='3205'
        and (a.wfxw1 in('6034','6035')
        or a.wfxw2 in('6034','6035')
        or a.wfxw3 in('6034','6035')
        or a.wfxw4 in('6034','6035')
        or a.wfxw5 in('6034','6035'))
        and left(wfsj,10) &gt;= '2020-01-01'
        and left(wfsj,10) &lt;= left(to_char((current_date-interval '30 day' ),'yyyy-MM-dd'),10)
        and a.cjbj='0'
        and a.xxly='1'
       union all
        select distinct *
        from ods.ods_rt_trff_app_vio_force a
        where substr(a.fxjg,1,4)='3205'
        and (a.wfxw1 in('6034','6035')
        or a.wfxw2 in('6034','6035')
        or a.wfxw3 in('6034','6035')
        or a.wfxw4 in('6034','6035')
        or a.wfxw5 in('6034','6035'))
        and left(wfsj,10) &gt;= '2020-01-01'
        and to_date(left(a.cjsj,10),'yyyy-MM-dd') &gt;= to_date(left(a.wfsj,10),'yyyy-MM-dd') + interval '30 day'
        and a.cjbj='1'
        and a.xxly='1'
        ) t
        <if test=" kw!='' and kw !=null ">
            and (t.dsr like '%'||#{kw}||'%' or t.jszh like '%'||#{kw}||'%')
        </if>
    </select>

    <select id="selectPageWxjs" resultType="java.util.HashMap">
        select jszh,
        dabh,
        zjcx,
        dsr,
        hphm,
        wfsj  from(
        select distinct *
        from ods.ods_rt_trff_app_vio_force a
        where substr(a.fxjg,1,4)='3205'
        and (a.wfxw1 in('6022','6032','6033')
        or a.wfxw2 in('6022','6032','6033')
        or a.wfxw3 in('6022','6032','6033')
        or a.wfxw4 in('6022','6032','6033')
        or a.wfxw5 in('6022','6032','6033'))
        and left(wfsj,10) &gt;= '2020-01-01'
        and left(wfsj,10) &lt;= to_char((current_date-interval '180 day' ),'yyyy-MM-dd')
        and a.cjbj='0'
        and a.xxly='1'
        union all
        select distinct *
        from ods.ods_rt_trff_app_vio_force a
        where substr(a.fxjg,1,4)='3205'
        and (a.wfxw1 in('6022','6032','6033')
        or a.wfxw2 in('6022','6032','6033')
        or a.wfxw3 in('6022','6032','6033')
        or a.wfxw4 in('6022','6032','6033')
        or a.wfxw5 in('6022','6032','6033'))
        and left(wfsj,10) &gt;= '2020-01-01'
        and to_date(left(a.cjsj,10),'yyyy-MM-dd') &gt;= to_date(left(a.wfsj,10),'yyyy-MM-dd') + interval '180 day'
        and a.cjbj='1'
        and a.xxly='1'
        ) t
        <if test=" kw!='' and kw !=null ">
            and (t.dsr like '%'||#{kw}||'%' or t.jszh like '%'||#{kw}||'%')
        </if>
    </select>

    <select id="stwhp" resultType="java.util.HashMap">
        SELECT   DISTINCT
        T3.LABEL -- 重点人员类别
        ,T1.PSON_NAME -- 姓名
        ,T1.PSON_IDCARD -- 身份证号
        ,T1.PSON_REG_TIME -- 登记时间
        ,T1.COMP_NAME -- 单位名称
        ,T1.PSON_WORKTYPE_GL as isgly  -- 是否管理人员，0否 1 是
        ,T1.PSON_WORKTYPE_CZ  as isczy-- 是否操作员，0否 1 是
        ,T1.PSON_WORKTYPE_BG  as isbgy-- 是否保管员，0否 1 是
        ,T1.PSON_WORKTYPE_ZB  as iszabwy -- 是否治安保卫员，0否 1 是
        ,T1.PSON_WORKTYPE_CG  as iscgy-- 是否采购员，0否 1 是
        ,T1.PSON_WORKTYPE_QT  as isqt-- 是否其他类型人员，0否 1 是
        FROM      ODS.ODS_RT_V_JSSZ_RENYUAN  T1
        LEFT JOIN ODS.ODS_RT_ZDRY_RY_ZDRYGLXX T2
        ON        T1.PSON_IDCARD = T2.GMSFHM
        LEFT JOIN ODS.ODS_ZDRY_SYS_DICT T3
        ON        T2.XLGLB = T3.VALUE
        AND       T3.TYPE = '重点人员人员细类(新)'
        WHERE     T3.LABEL IS NOT NULL
    </select>

    <select id="jdry" resultType="java.util.HashMap">
        SELECT DISTINCT
	    T3.LABEL -- 重点人员类别
	,
	T1.cyry -- 姓名
	,
	T1.sfzhm -- 身份证号
	,
	T1.djsj -- 登记时间
	,
	T1., -- 单位名称
	,
    CASE
		jdhysy
		WHEN '1' THEN
		'安全员'
		WHEN '2' THEN
		'监督员'
		WHEN '9' THEN
		'信息员' ELSE'一般从业人员'
	END gwlx -- 岗位类型
      FROM
	(
	SELECT
		dw.dwzj,
		dw.dwmc,
		ry.*
	FROM
		ods.ods_rt_zypt_sydw_jbxx dw
		INNER JOIN ods.ods_rt_zypt_t_yw_cyry ry ON dw.dwzj = ry.sgljg_zj
	WHERE
		dw.hydl = '2700'
		AND dw.hyxl = '2711'
		AND ( dw.scbs IS NULL OR dw.scbs = '0' )
		AND dw.yyzt = '01'
	) T1
	LEFT JOIN ODS.ODS_RT_ZDRY_RY_ZDRYGLXX T2 ON T1.sfzhm = T2.GMSFHM
	LEFT JOIN ODS.ODS_ZDRY_SYS_DICT T3 ON T2.XLGLB = T3.
    VALUE

	AND T3.TYPE = '重点人员人员细类(新)'
    WHERE
	T3.LABEL IS NOT NULL
    </select>

</mapper>