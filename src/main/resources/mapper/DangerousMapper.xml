<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.oceansoft.szga.smp.mapper.DangerousMapper">

    <select id="queryBaseInfo" resultType="java.util.Map">
        select * from rpt_aqjg_za_zbxx order by  zbbm
    </select>
    <select id="querySuperviseUnit" resultType="java.lang.Integer">
        SELECT sum(sl) FROM "rpt_aqjg_za_dwxx" WHERE yyzt = '01' and hwlb like concat('%',#{str},'%')
    </select>
    <select id="queryAllSuperviseUnit" resultType="java.lang.Integer">
        SELECT sum(sl) FROM "rpt_aqjg_za_dwxx" WHERE yyzt = '01'
    </select>
    <select id="querySfgyl" resultType="java.lang.Integer">
        SELECT sum(sl) FROM "rpt_aqjg_za_ryxx" WHERE sfzx = '0' and sfgly = '1'
    </select>
    <select id="querySfczy" resultType="java.lang.Integer">
        SELECT sum(sl) FROM "rpt_aqjg_za_ryxx" WHERE sfzx = '0' and sfczy = '1'
    </select>
    <select id="querySfzabwy" resultType="java.lang.Integer">
        SELECT sum(sl) FROM "rpt_aqjg_za_ryxx" WHERE sfzx = '0' and sfczy = '1'
    </select>
    <select id="queryDangerousDw" resultType="java.util.Map">
        SELECT
            fjmc,
        sum ( sl )
        FROM
            "rpt_aqjg_za_dwxx"
        WHERE
            yyzt = '01'
        <if test="zawxpdjdmList != null">
            AND zawxpdjdm IN
        <foreach item="item" index="index" collection="zawxpdjdmList" open="(" separator="," close=")">
            #{item}
        </foreach>
        </if>
        <if test="zawxpdjdmList != null">
            AND hwlb IN
            <foreach item="item" index="index" collection="zawxpdjdmList" open="(" separator="," close=")">
            #{item}
            </foreach>
        </if>
        GROUP BY
            fjmc
    </select>
    <select id="queryImportDw" resultType="java.util.Map">
        SELECT
            fjmc,
            SUM ( sl )
        FROM
            "rpt_aqjg_za_ryxx"
        WHERE
            sfzx = '0'
        <if test="ywlxdmList != null">
        <if test="ywlxdmList.contains(&quot;管理员&quot;)">
            and sfgly = '1'
        </if>
        <if test="ywlxdmList.contains(&quot;操作员&quot;)">
            and sfczy = '1'
        </if>
        <if test="ywlxdmList.contains(&quot;治安保卫员&quot;)">
            and sfzabwy = '1'
        </if>
        </if>
        GROUP BY
            fjmc
    </select>
    <select id="queryHighPoison" resultType="java.util.Map">
        SELECT fjmc, sum(sl) FROM "rpt_aqjg_za_wpfx" WHERE sjlx = '51' and wpdl = '1' GROUP BY fjmc
    </select>
    <select id="queryEasyBoom" resultType="java.util.Map">
        SELECT fjmc, sum(sl) FROM "rpt_aqjg_za_wpfx" WHERE sjlx = '51' and wpdl = '2' GROUP BY fjmc
    </select>
    <select id="queryHighPoisonLine" resultType="java.util.Map">
        <choose>
        <when test="type == 1">
            SELECT date,sum(sl) FROM (SELECT year||'-'||mon as date, sl FROM "rpt_aqjg_za_wpfx" WHERE sjlx = '51' and wpdl = '1')t GROUP BY date ORDER BY date ASC
        </when>
        <otherwise>
            SELECT year,sum(sl) FROM "rpt_aqjg_za_wpfx" WHERE sjlx = '51' and wpdl = '1' GROUP BY year order by year
        </otherwise>
        </choose>
    </select>
    <select id="queryEasyBoomLine" resultType="java.util.Map">
        <choose>
            <when test="type == 1">
                SELECT date,sum(sl) FROM (SELECT year||'-'||mon as date, sl FROM "rpt_aqjg_za_wpfx" WHERE sjlx = '51' and wpdl = '2')t GROUP BY date ORDER BY date ASC
            </when>
            <otherwise>
                SELECT year,sum(sl) FROM "rpt_aqjg_za_wpfx" WHERE sjlx = '51' and wpdl = '2' GROUP BY year order by year
            </otherwise>
        </choose>
    </select>
    <select id="queryCurrentStockNum" resultType="java.util.Map">
        select * from rpt_aqjg_za_zbxx where zbbm = 'ZB_0003'
    </select>
    <select id="queryHalfYearNum" resultType="java.util.Map">
        select * from rpt_aqjg_za_zbxx where zbbm = 'ZB_0012'
    </select>
    <select id="queryHousingAllNum" resultType="java.lang.Long">
        select sum(sl) sl from rpt_aqjg_za_wpcrk where lbdm like '1%'
    </select>
    <select id="queryBuyNum" resultType="java.lang.Long">
        select sl from rpt_aqjg_za_wpcrk where lbdm = '11'
    </select>
    <select id="queryProductNum" resultType="java.lang.Long">
        select sl from rpt_aqjg_za_wpcrk where lbdm = '12'
    </select>
    <select id="queryWpcrk" resultType="java.util.Map">
        select * from rpt_aqjg_za_wpcrk
    </select>
    <select id="queryUseHousingNum" resultType="java.lang.Long">
        select sum(sl) sl from rpt_aqjg_za_wpcrk where lbdm like '5%'
    </select>
    <select id="queryDangerHighPoisonDw" resultType="java.util.Map">
        SELECT a.fjmc,a.jd,b.jy FROM
        ((SELECT fjmc,sum(sl) jd FROM "rpt_aqjg_za_dwxx" WHERE yyzt = '01' AND hwlb like concat('%',#{hwlb},'%')
        <if test="year != null">
        and year = #{year}
        </if>
        GROUP BY fjmc) a LEFT JOIN
        (SELECT fjmc,sum(sl) jy FROM "rpt_aqjg_za_dwxx" WHERE yyzt = '01' AND hwlb like '%1%8%'
        <if test="year != null">
            and year = #{year}
        </if>
        GROUP BY fjmc) b ON a.fjmc = b.fjmc)
    </select>
    <select id="queryDangerHighPoisonLxAllCount" resultType="java.lang.Long">
        SELECT sum(sl) FROM "rpt_aqjg_za_wpfx" WHERE wpdl = #{wpdl}
    </select>
    <select id="queryEveryKindNum" resultType="java.util.Map">
        SELECT wpmc,sum(sl) FROM "rpt_aqjg_za_wpfx" WHERE wpdl = #{wpdl} AND sjlx = #{type}
        <if test="year != null">
            and year = #{year}
        </if>
         GROUP BY wpmc
    </select>
    <select id="queryDangerHighPoisonRank" resultType="java.util.Map">
        SELECT fjmc, sum(sl) FROM "rpt_aqjg_za_wpfx" WHERE wpdl = #{wpdl} AND sjlx = #{type}
        <if test="year != null">
            and year = #{year}
        </if>
         GROUP BY fjmc ORDER BY sum(sl) desc LIMIT 10
    </select>
    <select id="queryCompanyRank" resultType="java.util.Map">
        SELECT fjmc,sum(sl) FROM "rpt_aqjg_za_dwxx" GROUP BY fjmc
    </select>
    <select id="queryImpPostRank" resultType="java.util.Map">
        SELECT fjmc, sum(sl) FROM "rpt_aqjg_za_ryxx" WHERE sfzx = '0' GROUP BY fjmc
    </select>
    <select id="queryCompanyCheckRank" resultType="java.util.Map">
        SELECT ssfxjmc, sum(sl) FROM "rpt_aqjg_za_dwjcxx" WHERE jcztdm = '2' GROUP BY ssfxjmc
    </select>
    <select id="queryHiddenDiscoverRank" resultType="java.util.Map">
        SELECT fjmc, sum(sl) FROM "rpt_aqjg_za_dwyhxx" GROUP BY fjmc
    </select>
    <select id="queryHiddenHandleRank" resultType="java.util.Map">
        SELECT fjmc, sum(sl) FROM "rpt_aqjg_za_dwyhxx" WHERE sfzg = '1' GROUP BY fjmc
    </select>
    <select id="queryHiddenNoHandleRank" resultType="java.util.Map">
        SELECT fjmc, sum(sl) FROM "rpt_aqjg_za_dwyhxx" WHERE sfzg = '0' GROUP BY fjmc
    </select>
    <select id="queryEarlyHandleRank" resultType="java.util.Map">
        SELECT fjmc,sum(sl) FROM "rpt_aqjg_za_yjxx" GROUP BY fjmc
    </select>
    <select id="queryNumAnalysisZg" resultType="java.util.Map">
        SELECT fjmc, SUM ( sl ) zgl FROM "rpt_aqjg_za_dwyhxx" WHERE hwlb LIKE concat('%',#{hwlb},'%') AND sfzg = '1'
        <if test="jcjgList != null">
        AND jcjg IN
        <foreach item="item" index="index" collection="jcjgList" open="(" separator="," close=")">
            #{item}
        </foreach>
        </if>
        GROUP BY fjmc
    </select>
    <select id="queryNumAnalysisWzg" resultType="java.util.Map">
        SELECT fjmc, SUM ( sl ) wzgl FROM "rpt_aqjg_za_dwyhxx" WHERE hwlb LIKE concat('%',#{hwlb},'%') AND sfzg = '0'
        <if test="jcjgList != null">
            AND jcjg IN
            <foreach item="item" index="index" collection="jcjgList" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        GROUP BY fjmc
    </select>
    <select id="queryDrillRank1" resultType="java.util.Map">
        SELECT pcsmc,sum(sl) FROM "rpt_aqjg_za_dwxx" WHERE fjmc = #{fjmc} GROUP BY pcsmc ORDER BY sum desc
    </select>
    <select id="queryDrillRank2" resultType="java.util.Map">
        SELECT pcsmc,sum(sl) FROM "rpt_aqjg_za_ryxx" WHERE sfzx = '0' AND fjmc = #{fjmc} GROUP BY pcsmc ORDER BY sum desc
    </select>
    <select id="queryDrillRank3" resultType="java.util.Map">
        SELECT sspcsmc,sum(sl) FROM "rpt_aqjg_za_dwjcxx" WHERE jcztdm = '2' AND ssfxjmc = #{fjmc} GROUP BY sspcsmc ORDER BY sum desc
    </select>
    <select id="queryDrillRank5" resultType="java.util.Map">
        SELECT pcsmc,sum(sl) FROM "rpt_aqjg_za_dwyhxx" WHERE fjmc = #{fjmc} GROUP BY pcsmc ORDER BY sum desc
    </select>
    <select id="queryDrillRank6" resultType="java.util.Map">
        SELECT pcsmc,sum(sl) FROM "rpt_aqjg_za_dwyhxx" WHERE fjmc = #{fjmc} AND sfzg = '1' GROUP BY pcsmc ORDER BY sum desc
    </select>
    <select id="queryDrillRank7" resultType="java.util.Map">
        SELECT pcsmc,sum(sl) FROM "rpt_aqjg_za_dwyhxx" WHERE fjmc = #{fjmc} AND sfzg = '0' GROUP BY pcsmc ORDER BY sum desc
    </select>
    <select id="queryDrillRank8" resultType="java.util.Map">
        SELECT pcsmc,sum(sl) FROM "rpt_aqjg_za_yjxx" WHERE fjmc = #{fjmc} GROUP BY pcsmc ORDER BY sum desc
    </select>
    <select id="queryNumSituation" resultType="java.util.Map">
        <if test="type == 'yf'">
            SELECT b.date,COALESCE(b.zgs,0)zgs,COALESCE(c.wzgs,0)wzgs
            FROM
            (SELECT date, COALESCE(sum(sl),0) zgs FROM
            (
            SELECT date,yearDate,hwlb,sfzg,sl FROM (
            SELECT year||'-'||mon as date,year as yearDate,hwlb,sfzg,sl FROM "rpt_aqjg_za_dwyhxx"
            ) a
            WHERE date BETWEEN #{beginTime} AND #{endTime}
            ) a WHERE sfzg = '1' and hwlb like concat('%',#{hwlb},'%') GROUP BY date) b
            LEFT JOIN
            (SELECT date, COALESCE(sum(sl),0) wzgs FROM
            (
            SELECT date,yearDate,hwlb,sfzg,sl FROM (
            SELECT year||'-'||mon as date,year as yearDate,hwlb,sfzg,sl FROM "rpt_aqjg_za_dwyhxx"
            ) a
            WHERE date BETWEEN #{beginTime} AND #{endTime}
            ) a WHERE sfzg = '0' and hwlb like concat('%',#{hwlb},'%') GROUP BY date) c
            ON b.date = c.date order by b.date
        </if>
        <if test="type == 'nf'">
            SELECT b.yearDate,COALESCE(b.zgs,0)zgs,COALESCE(c.wzgs,0)wzgs FROM
            (SELECT yearDate, COALESCE(sum(sl),0) zgs
            FROM
            (SELECT year||'-'||mon as date,year as yearDate,hwlb,sfzg,sl FROM "rpt_aqjg_za_dwyhxx") a WHERE sfzg = '1' and hwlb like concat('%',#{hwlb},'%') GROUP BY yeardate) b
            LEFT JOIN
            (SELECT yearDate, COALESCE(sum(sl),0) wzgs
            FROM
            (SELECT year||'-'||mon as date,year as yearDate,hwlb,sfzg,sl FROM "rpt_aqjg_za_dwyhxx") a WHERE sfzg = '0' and hwlb like concat('%',#{hwlb},'%') GROUP BY yeardate) c
            ON b.yearDate = c.yearDate order by b.yearDate
        </if>
    </select>
    <select id="queryAjAllCount" resultType="java.lang.Integer">
        SELECT sum(sl) allCount FROM "rpt_aqjg_za_ajxx"
    </select>
    <select id="queryCheckHit" resultType="java.util.Map">
        SELECT a.fjmc, COALESCE(b.xz,0) xz, COALESCE(c.xs,0)xs
        FROM
        (SELECT fjmc FROM "rpt_aqjg_za_ajxx" GROUP BY fjmc) a
        LEFT JOIN
        (SELECT fjmc,COALESCE(sum(sl),0) xz FROM "rpt_aqjg_za_ajxx" WHERE ajdlmc = '行政案件'
         <if test="ajlbdm != null and ajlbdm != ''">
             and ajlbdm = #{ajlbdm}
         </if>
         GROUP BY fjmc) b ON a.fjmc = b.fjmc
        LEFT JOIN
        (SELECT fjmc,COALESCE(sum(sl),0) xs FROM "rpt_aqjg_za_ajxx" WHERE ajdlmc = '刑事案件'
        <if test="ajlbdm != null and ajlbdm != ''">
            and ajlbdm = #{ajlbdm}
        </if>
         GROUP BY fjmc) c ON a.fjmc = c.fjmc
    </select>
    <select id="queryPeopleBackgroud" resultType="java.util.Map">
        SELECT a.fjmc, COALESCE(b.yqk,0) yqk, COALESCE(c.wqk,0) wqk FROM
        (SELECT fjmc FROM "rpt_aqjg_za_ryxx" GROUP BY fjmc) a
        LEFT JOIN
        (SELECT fjmc,COALESCE(sum(sl),0) yqk FROM "rpt_aqjg_za_ryxx" WHERE sfzx = '0' AND ywqk = '1' GROUP BY fjmc) b ON a.fjmc = b.fjmc
        LEFT JOIN
        (SELECT fjmc,COALESCE(sum(sl),0) wqk FROM "rpt_aqjg_za_ryxx" WHERE sfzx = '0' AND ywqk = '0' GROUP BY fjmc) c ON a.fjmc = c.fjmc
    </select>
    <select id="queryFjmc" resultType="java.lang.String">
        SELECT fjmc FROM rpt_aqjg_za_ryxx GROUP BY fjmc
    </select>
    <select id="queryAllPeopleCount" resultType="java.lang.Integer">
        SELECT sum(sl) FROM rpt_aqjg_za_ryxx WHERE sfzx = '0'
    </select>
    <select id="queryPeopleBusiness" resultType="java.util.Map">
        SELECT ywlxmc,sum(sl) FROM rpt_aqjg_za_ryxx WHERE sfzx = '0'
        <if test="fjmcList != null">
        AND fjmc IN
            <foreach item="item" index="index" collection="fjmcList" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        GROUP BY ywlxmc
    </select>
    <select id="queryPeopleZcState1" resultType="java.util.Map">
        with new_ryxx as (SELECT year||'-'||mon as date, year as yearDate, fjmc,baztdm, sfzx, sl FROM rpt_aqjg_za_ryxx)
        <choose>
            <when test="type=='yf'">
                SELECT date,sum(sl) FROM new_ryxx WHERE date BETWEEN #{beginTime} AND #{endTime}
                <if test="fjmcList != null">
                    AND fjmc IN
                    <foreach item="item" index="index" collection="fjmcList" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                GROUP BY date ORDER BY date
            </when>
            <otherwise>
                SELECT yearDate,sum(sl) FROM new_ryxx where 1=1
                <if test="fjmcList != null">
                    AND fjmc IN
                    <foreach item="item" index="index" collection="fjmcList" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                GROUP BY yearDate ORDER BY yearDate
            </otherwise>
        </choose>
    </select>
    <select id="queryPeopleZcState2" resultType="java.util.Map">
        with new_ryxx as (SELECT year||'-'||mon as date, year as yearDate, fjmc,baztdm, sfzx, sl FROM rpt_aqjg_za_ryxx)
        <choose>
            <when test="type=='yf'">
                SELECT date,sum(sl) FROM new_ryxx WHERE sfzx = '1' and date BETWEEN #{beginTime} AND #{endTime}
                <if test="fjmcList != null">
                    AND fjmc IN
                    <foreach item="item" index="index" collection="fjmcList" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                GROUP BY date ORDER BY date
            </when>
            <otherwise>
                SELECT yearDate,sum(sl) FROM new_ryxx where sfzx = '1'
                <if test="fjmcList != null">
                    AND fjmc IN
                    <foreach item="item" index="index" collection="fjmcList" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                GROUP BY yearDate ORDER BY yearDate
            </otherwise>
        </choose>
    </select>
    <select id="queryPeopleZcState3" resultType="java.util.Map">
        with new_ryxx as (SELECT year||'-'||mon as date, year as yearDate, fjmc,baztdm, sfzx, sl FROM rpt_aqjg_za_ryxx)
        <choose>
            <when test="type=='yf'">
                SELECT date,sum(sl) FROM new_ryxx WHERE sfzx = '0' and date BETWEEN #{beginTime} AND #{endTime}
                <if test="fjmcList != null">
                    AND fjmc IN
                    <foreach item="item" index="index" collection="fjmcList" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                GROUP BY date ORDER BY date
            </when>
            <otherwise>
                SELECT yearDate,sum(sl) FROM new_ryxx where sfzx = '0'
                <if test="fjmcList != null">
                    AND fjmc IN
                    <foreach item="item" index="index" collection="fjmcList" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                GROUP BY yearDate ORDER BY yearDate
            </otherwise>
        </choose>
    </select>
    <select id="queryPeopleBaState1" resultType="java.util.Map">
        with new_ryxx as (SELECT year||'-'||mon as date, year as yearDate, fjmc,baztdm, sfzx, sl FROM rpt_aqjg_za_ryxx)
        <choose>
            <when test="type=='yf'">
                SELECT date,sum(sl) FROM new_ryxx WHERE date BETWEEN #{beginTime} AND #{endTime}
                <if test="fjmcList != null">
                    AND fjmc IN
                    <foreach item="item" index="index" collection="fjmcList" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                GROUP BY date ORDER BY date
            </when>
            <otherwise>
                SELECT yearDate,sum(sl) FROM new_ryxx where 1=1
                <if test="fjmcList != null">
                    AND fjmc IN
                    <foreach item="item" index="index" collection="fjmcList" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                GROUP BY yearDate ORDER BY yearDate
            </otherwise>
        </choose>
    </select>
    <select id="queryPeopleBaState2" resultType="java.util.Map">
        with new_ryxx as (SELECT year||'-'||mon as date, year as yearDate, fjmc,baztdm, sfzx, sl FROM rpt_aqjg_za_ryxx)
        <choose>
            <when test="type=='yf'">
                SELECT date,sum(sl) FROM new_ryxx WHERE baztdm = '0' and date BETWEEN #{beginTime} AND #{endTime}
                <if test="fjmcList != null">
                    AND fjmc IN
                    <foreach item="item" index="index" collection="fjmcList" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                GROUP BY date ORDER BY date
            </when>
            <otherwise>
                SELECT yearDate,sum(sl) FROM new_ryxx where baztdm = '0'
                <if test="fjmcList != null">
                    AND fjmc IN
                    <foreach item="item" index="index" collection="fjmcList" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                GROUP BY yearDate ORDER BY yearDate
            </otherwise>
        </choose>
    </select>
    <select id="queryPeopleBaState3" resultType="java.util.Map">
        with new_ryxx as (SELECT year||'-'||mon as date, year as yearDate, fjmc,baztdm, sfzx, sl FROM rpt_aqjg_za_ryxx)
        <choose>
            <when test="type=='yf'">
                SELECT date,sum(sl) FROM new_ryxx WHERE sfzx = '1' and date BETWEEN #{beginTime} AND #{endTime}
                <if test="fjmcList != null">
                    AND fjmc IN
                    <foreach item="item" index="index" collection="fjmcList" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                GROUP BY date ORDER BY date
            </when>
            <otherwise>
                SELECT yearDate,sum(sl) FROM new_ryxx where sfzx = '1'
                <if test="fjmcList != null">
                    AND fjmc IN
                    <foreach item="item" index="index" collection="fjmcList" open="(" separator="," close=")">
                        #{item}
                    </foreach>
                </if>
                GROUP BY yearDate ORDER BY yearDate
            </otherwise>
        </choose>
    </select>
    <select id="queryPeopleRecord" resultType="java.util.Map">
        SELECT fjmc,sum(sl) FROM "rpt_aqjg_za_ryxx" WHERE sfzx = '0' and ywlxdm = #{ywlxdm} GROUP BY fjmc
    </select>
    <select id="queryPeopleNumByDm" resultType="java.util.Map">
        SELECT * FROM (
        SELECT '管理员' as name, sum(sl) FROM rpt_aqjg_za_ryxx WHERE sfzx = '0' AND sfgly = '1' AND ywlxdm = #{ywlxdm}
        UNION
        SELECT '操作员', sum(sl) FROM rpt_aqjg_za_ryxx WHERE sfzx = '0' AND sfczy = '1' AND ywlxdm = #{ywlxdm}
        UNION
        SELECT '治安保卫员', sum(sl) FROM rpt_aqjg_za_ryxx WHERE sfzx = '0' AND sfzabwy = '1' AND ywlxdm = #{ywlxdm}
        ) t ORDER BY t.sum desc
    </select>


</mapper>